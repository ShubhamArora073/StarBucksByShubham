################################################################################
# Kube-Prometheus-Stack Helm Chart Values
# Complete monitoring solution with Prometheus, Grafana, and AlertManager
################################################################################

# Global settings
fullnameOverride: "prometheus"

################################################################################
# Prometheus Configuration
################################################################################
prometheus:
  enabled: true
  
  prometheusSpec:
    # Retention period for metrics
    retention: 15d
    retentionSize: "10GB"
    
    # Resource configuration
    resources:
      requests:
        cpu: "200m"
        memory: "1Gi"
      limits:
        cpu: "1000m"
        memory: "2Gi"
    
    # Storage configuration
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp3
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi
    
    # Node selector for monitoring nodes
    nodeSelector:
      workload: monitoring
    
    # Service Monitor selector - monitor all namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    serviceMonitorSelector: {}
    serviceMonitorNamespaceSelector: {}
    
    # Pod Monitor selector
    podMonitorSelectorNilUsesHelmValues: false
    podMonitorSelector: {}
    podMonitorNamespaceSelector: {}
    
    # Probe selector
    probeSelectorNilUsesHelmValues: false
    probeSelector: {}
    probeNamespaceSelector: {}
    
    # Rule selector
    ruleSelectorNilUsesHelmValues: false
    ruleSelector: {}
    ruleNamespaceSelector: {}
    
    # Additional scrape configs for external targets
    additionalScrapeConfigs: []

  # Ingress for Prometheus (disabled - using separate ingress)
  ingress:
    enabled: false

################################################################################
# Grafana Configuration
################################################################################
grafana:
  enabled: true
  
  # Admin credentials
  adminUser: admin
  adminPassword: "GrafanaAdmin@2024"
  
  # Resource configuration
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  
  # Persistence
  persistence:
    enabled: true
    storageClassName: gp3
    size: 10Gi
  
  # Node selector
  nodeSelector:
    workload: monitoring
  
  # Ingress (disabled - using separate ingress)
  ingress:
    enabled: false
  
  # Default dashboards
  defaultDashboardsEnabled: true
  defaultDashboardsTimezone: UTC
  
  # Sidecar for dashboard provisioning
  sidecar:
    dashboards:
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      searchNamespace: ALL
    datasources:
      enabled: true
      defaultDatasourceEnabled: true
      label: grafana_datasource
      labelValue: "1"
  
  # Additional data sources
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki:3100
      access: proxy
      isDefault: false
  
  # Grafana.ini configuration
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s/"
    auth.anonymous:
      enabled: false
    security:
      admin_user: admin
    users:
      allow_sign_up: false

################################################################################
# AlertManager Configuration
################################################################################
alertmanager:
  enabled: true
  
  alertmanagerSpec:
    # Resource configuration
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"
    
    # Storage
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: gp3
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 5Gi
    
    # Node selector
    nodeSelector:
      workload: monitoring
  
  # Ingress (disabled)
  ingress:
    enabled: false
  
  # AlertManager configuration
  config:
    global:
      resolve_timeout: 5m
    
    route:
      group_by: ['alertname', 'namespace']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h
      receiver: 'default-receiver'
      routes:
        - match:
            severity: critical
          receiver: 'critical-receiver'
        - match:
            severity: warning
          receiver: 'warning-receiver'
    
    receivers:
      - name: 'default-receiver'
        # Add webhook, email, or slack configuration here
      - name: 'critical-receiver'
        # Add critical alert configuration here
      - name: 'warning-receiver'
        # Add warning alert configuration here
    
    inhibit_rules:
      - source_match:
          severity: 'critical'
        target_match:
          severity: 'warning'
        equal: ['alertname', 'namespace']

################################################################################
# Prometheus Node Exporter
################################################################################
prometheus-node-exporter:
  enabled: true
  
  resources:
    requests:
      cpu: "50m"
      memory: "32Mi"
    limits:
      cpu: "200m"
      memory: "64Mi"

################################################################################
# Kube State Metrics
################################################################################
kube-state-metrics:
  enabled: true
  
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"

################################################################################
# Prometheus Operator
################################################################################
prometheusOperator:
  enabled: true
  
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  
  nodeSelector:
    workload: monitoring

################################################################################
# Default Rules
################################################################################
defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    configReloaders: true
    general: true
    k8s: true
    kubeApiserverAvailability: true
    kubeApiserverBurnrate: true
    kubeApiserverHistogram: true
    kubeApiserverSlos: true
    kubeControllerManager: true
    kubelet: true
    kubeProxy: true
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeSchedulerAlerting: true
    kubeSchedulerRecording: true
    kubeStateMetrics: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true

################################################################################
# Additional PrometheusRules
################################################################################
additionalPrometheusRulesMap: {}

################################################################################
# Kubelet Service Monitor
################################################################################
kubelet:
  enabled: true
  serviceMonitor:
    https: true

